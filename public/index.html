<!DOCTYPE html>
<html lang="ru-RU">
  <head>
    <meta charset="UTF-8" />
    <title>–ö–∞–∫ –ö–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å –ø–æ–≤–ª–∏—è–ª –Ω–∞ IT</title>
    <link rel="stylesheet" type="text/css" href="/public/style.css" />
    <script src="https://covid19.seniorsoftwarevlogger.com/d3.5.js"></script>
    <script src="https://covid19.seniorsoftwarevlogger.com/d3-array.1.js"></script>
    <script src="https://covid19.seniorsoftwarevlogger.com/d3-collection.1.js"></script>
    <script src="https://covid19.seniorsoftwarevlogger.com/d3-path.1.js"></script>
    <script src="https://covid19.seniorsoftwarevlogger.com/d3-shape.1.js"></script>
    <script>
      (async function main() {
        const csv = await fetch("/public/data.csv?20200410");
        const csvData = await csv.text();

        const weights = {
          "–ü–æ–ø–µ—Ä–ª–∏ –∑–∞–∫–∞–∑—ã / –°—Ç–∞–ª–æ –ª—É—á—à–µ": 1,
          –ù–∏–∫–∞–∫: 2,
          "–£—Ä–µ–∑–∞–ª–∏ –ó–ü / –ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–π –æ—Ç–ø—É—Å–∫ / –°—Ç–∞–ª–æ —Ö—É–∂–µ": 3,
          –£–≤–æ–ª–∏–ª–∏: 4,
        };
        const impactLabels = {
          "–ü–æ–ø–µ—Ä–ª–∏ –∑–∞–∫–∞–∑—ã / –°—Ç–∞–ª–æ –ª—É—á—à–µ": "–°—Ç–∞–ª–æ –ª—É—á—à–µ üòé",
          –ù–∏–∫–∞–∫: "–ù–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å üôÇ",
          "–£—Ä–µ–∑–∞–ª–∏ –ó–ü / –ù–µ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–π –æ—Ç–ø—É—Å–∫ / –°—Ç–∞–ª–æ —Ö—É–∂–µ": "–°—Ç–∞–ª–æ —Ö—É–∂–µ üôÅ",
          –£–≤–æ–ª–∏–ª–∏: "–ü–æ—Ç–µ—Ä—è–ª —Ä–∞–±–æ—Ç—É üò´",
        };
        const keys = [
          "–ö–µ–º —Ä–∞–±–æ—Ç–∞—é",
          "–î–æ–ª–∂–Ω–æ—Å—Ç—å",
          "–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏",
          "–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω",
          "–°—Ç—Ä–∞–Ω–∞",
        ];

        let data = d3.csvParse(csvData, d3.autoType);
        const counters = {};
        const countries = new Set();

        data.forEach((e) => {
          countries.add(e["–°—Ç—Ä–∞–Ω–∞"]);

          keys.forEach((k) => {
            if (!counters[`${k}:${e[k]}`]) counters[`${k}:${e[k]}`] = 0;
            counters[`${k}:${e[k]}`]++;
          });
        });

        document.getElementById("peopleCounter").innerText = data.length;

        data = data.sort((a, b) => {
          if (
            weights[a["–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω"]] >
            weights[b["–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω"]]
          )
            return 1;
          if (
            weights[a["–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω"]] <
            weights[b["–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω"]]
          )
            return -1;
          if (
            counters[`–ö–µ–º —Ä–∞–±–æ—Ç–∞—é:${a["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]}`] <
            counters[`–ö–µ–º —Ä–∞–±–æ—Ç–∞—é:${b["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]}`]
          )
            return 1;
          if (
            counters[`–ö–µ–º —Ä–∞–±–æ—Ç–∞—é:${a["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]}`] >
            counters[`–ö–µ–º —Ä–∞–±–æ—Ç–∞—é:${b["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]}`]
          )
            return -1;
          if (
            counters[`–î–æ–ª–∂–Ω–æ—Å—Ç—å:${a["–î–æ–ª–∂–Ω–æ—Å—Ç—å"]}`] <
            counters[`–î–æ–ª–∂–Ω–æ—Å—Ç—å:${b["–î–æ–ª–∂–Ω–æ—Å—Ç—å"]}`]
          )
            return 1;
          if (
            counters[`–î–æ–ª–∂–Ω–æ—Å—Ç—å:${a["–î–æ–ª–∂–Ω–æ—Å—Ç—å"]}`] >
            counters[`–î–æ–ª–∂–Ω–æ—Å—Ç—å:${b["–î–æ–ª–∂–Ω–æ—Å—Ç—å"]}`]
          )
            return -1;
          if (
            counters[`–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏:${a["–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"]}`] <
            counters[`–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏:${b["–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"]}`]
          )
            return 1;
          if (
            counters[`–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏:${a["–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"]}`] >
            counters[`–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏:${b["–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"]}`]
          )
            return -1;

          if (
            counters[`–°—Ç—Ä–∞–Ω–∞:${a["–°—Ç—Ä–∞–Ω–∞"]}`] <
            counters[`–°—Ç—Ä–∞–Ω–∞:${b["–°—Ç—Ä–∞–Ω–∞"]}`]
          )
            return 1;
          if (
            counters[`–°—Ç—Ä–∞–Ω–∞:${a["–°—Ç—Ä–∞–Ω–∞"]}`] >
            counters[`–°—Ç—Ä–∞–Ω–∞:${b["–°—Ç—Ä–∞–Ω–∞"]}`]
          )
            return -1;
        });

        const chartContainer = d3.select("#main-chart");

        function renderChart(chartContainer, data) {
          const chartData = {
            "–°—Ç–∞–ª–æ –ª—É—á—à–µ üòé": { total: 0 },
            "–ù–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å üôÇ": { total: 0 },
            "–°—Ç–∞–ª–æ —Ö—É–∂–µ üôÅ": { total: 0 },
            "–ü–æ—Ç–µ—Ä—è–ª —Ä–∞–±–æ—Ç—É üò´": { total: 0 },
          };
          const proffessions = new Set();
          data.forEach((d) => {
            proffessions.add(d["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]);

            const impactName = impactLabels[d["–ö–∞–∫ –æ—Ç—Ä–∞–∑–∏–ª—Å—è –∫–∞—Ä–∞–Ω—Ç–∏–Ω"]];
            if (chartData[impactName][d["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]] == null) {
              chartData[impactName][d["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]] = 0;
            }

            chartData[impactName][d["–ö–µ–º —Ä–∞–±–æ—Ç–∞—é"]]++;
            chartData[impactName]["total"]++;
          });

          const chartData1 = Object.entries(chartData).map(([name, value]) => ({
            name,
            ...value,
          }));

          const series = d3
            .stack()
            .keys(Array.from(proffessions))(chartData1)
            .map((d) => (d.forEach((v) => (v.key = d.key)), d));

          const width = 1286;

          const margin = { top: 30, right: 50, bottom: 0, left: 215 };
          const barHeight = 50;
          const height =
            chartData1.length * barHeight + margin.top + margin.bottom;

          const x = d3
            .scaleLinear()
            .domain([0, d3.max(series, (d) => d3.max(d, (d) => d[1]))])
            .range([margin.left, width - margin.right]);

          const y = d3
            .scaleBand()
            .domain(chartData1.map((d) => d.name))
            .range([margin.top, height - margin.bottom])
            .padding(0.2);

          const color = d3
            .scaleOrdinal()
            .domain(series.map((d) => d.key))
            .range([
              "#1284FF",
              "#30D157",
              "#5E5CE6",
              "#FD9F08",
              "#FD375F",
              "#BF5AF2",
              "#FD4539",
              "#64D2FF",
              "#FED50B",
            ])

            .unknown("#ccc");

          const yAxis = (g) =>
            g
              .attr("transform", `translate(${margin.left},0)`)
              .style("font", "15px sans-serif")
              .call(
                d3.axisLeft(y).tickSizeOuter(0).tickSizeInner(0).tickPadding(14)
              )
              .call((g) => g.selectAll(".domain").remove());
          const formatValue = (x) =>
            isNaN(x) ? "N/A" : x.toLocaleString("en");

          chartContainer.selectAll("svg").remove();
          const svg = chartContainer
            .append("svg")
            .attr("viewBox", [0, 0, width, height]);

          svg
            .append("g")
            .selectAll("g")
            .data(series.slice(0, 1))
            .join("g")
            .attr("fill", "#D8D8D8")
            .attr("fill-opacity", "0.37")
            .selectAll("rect")
            .data((d) => d)
            .join("rect")
            .attr("x", (d) => x(d[0]))
            .attr("y", (d, i) => y(d.data.name))
            .attr("width", width)
            .attr("height", y.bandwidth())
            .append("text")
            .text("123")
            .attr("x", (d) => x(d[0]))
            .attr("y", (d, i) => y(d.data.name));

          svg
            .append("g")
            .selectAll("g")
            .data(series)
            .join("g")
            .attr("fill", (d) => color(d.key))
            .selectAll("rect")
            .data((d) => d)
            .join("rect")
            .attr("x", (d) => x(d[0]))
            .attr("y", (d, i) => y(d.data.name))
            .attr("width", (d) => x(d[1]) - x(d[0]))
            .attr("height", y.bandwidth())
            .append("title")
            .text((d) => `${d.key} ${formatValue(d.data[d.key])}`);

          svg
            .append("g")
            .selectAll("g")
            .data(series.slice(0, 1))
            .join("g")
            .attr("fill", "rgba(39, 40, 44, 0.4)")
            .attr("text-anchor", "end")
            .style("font", "12px sans-serif")
            .selectAll("text")
            .data((d) => d)
            .join("text")
            .attr("x", (d) => width - 10)
            .attr("y", (d, i) => y(d.data.name) + 25)
            .attr("width", width)
            .attr("height", y.bandwidth())
            .text(
              (d) =>
                `${Math.round(
                  (d.data.total / data.length) * 100 + Number.EPSILON
                )}%`
            );
          // font-family: Helvetica;
          // font-size: 12px;
          // color: rgba(39,40,44,0.40);
          // letter-spacing: 0;
          // text-align: right;
          // line-height: 16px;

          svg.append("g").call(yAxis);
        }

        document
          .getElementById("filterForm")
          .addEventListener("change", (chEvent) => {
            const formData = chEvent.currentTarget.elements;

            let filteredData = data;

            if (countryFilter.value !== "") {
              filteredData = filteredData.filter(
                (d) => d["–°—Ç—Ä–∞–Ω–∞"] === countryFilter.value
              );
            }
            if (companyFilter.value !== "") {
              filteredData = filteredData.filter(
                (d) => d["–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"] === companyFilter.value
              );
            }

            renderChart(chartContainer, filteredData);
          });

        const countryFilter = document.getElementById("countryFilter");

        countryFilter.innerHTML =
          `<option value="">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>` +
          Array.from(countries)
            .sort((a, b) => (a >= b ? 1 : -1))
            .map((country) => {
              return `<option value="${country}">${country}</option>`;
            })
            .join("");

        renderChart(chartContainer, data);
      })();
    </script>
  </head>
  <body>
    <div class="header">
      <section>
        –í –æ–ø—Ä–æ—Å–µ –ø—Ä–∏–Ω—è–ª–æ —É—á–∞—Å—Ç–∏–µ
        <span id="peopleCounter">–±–æ–ª–µ–µ 3000</span> —á–µ–ª–æ–≤–µ–∫. –ë–æ–ª—å—à–æ–µ –≤–∞–º
        —Å–ø–∞—Å–∏–±–æ!<br />–ö—Å—Ç–∞—Ç–∏, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —É –≤–∞—Å —á—Ç–æ –ø–æ–º–µ–Ω—è–ª–æ—Å—å ‚Äî –ø–æ–∂–∞–ª—É–π—Å—Ç–∞,
        <a href="https://forms.gle/1k4QQYx6WyxeFG8i9"
          >–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç</a
        >.
      </section>
      <aside>
        <a href="">–ü–æ—É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –æ–ø—Ä–æ—Å–µ</a>
      </aside>
    </div>
    <div class="content">
      <section>
        <h1>–í–ª–∏—è–Ω–∏–µ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–∞ –Ω–∞ IT</h1>
        <p class="lead-text">
          –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–º, –Ω–µ –≤–∞–∂–Ω–æ,<br />–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Ç—ã
          –∏–ª–∏ –¥–∏–∑–∞–π–Ω–µ—Ä–∫–∞.
        </p>
      </section>
      <section>
        <div class="filterForm">
          <form id="filterForm">
            <select class="filter" id="countryFilter">
              <option value="">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>
              <option value="–†–æ—Å—Å–∏—è">–†–æ—Å—Å–∏—è</option>
              <option value="–£–∫—Ä–∞–∏–Ω–∞">–£–∫—Ä–∞–∏–Ω–∞</option>
              <option value="–ë–µ–ª–∞—Ä—É—Å—å">–ë–µ–ª–∞—Ä—É—Å—å</option>
            </select>
            <select class="filter" id="companyFilter">
              <option value="">–í—Å–µ —Ç–∏–ø—ã –∫–æ–º–ø–∞–Ω–∏–π</option>
              <option value="–§—Ä–∏–ª–∞–Ω—Å–µ—Ä">–§—Ä–∏–ª–∞–Ω—Å–µ—Ä</option>
              <option value="–ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è">–ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è</option>
              <option value="–ö–æ–º–ø–∞–Ω–∏—è –∞—É—Ç—Å–æ—Ä—Å">–ö–æ–º–ø–∞–Ω–∏—è –∞—É—Ç—Å–æ—Ä—Å</option>
              <option value="–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤–µ–±-—Å—Ç—É–¥–∏—è)"
                >–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤–µ–±-—Å—Ç—É–¥–∏—è)</option
              >
              <option value="IT –æ—Ç–¥–µ–ª –≤ –∫–æ–º–ø–∞–Ω–∏–∏">IT –æ—Ç–¥–µ–ª –≤ –∫–æ–º–ø–∞–Ω–∏–∏</option>
            </select>
          </form>
        </div>
      </section>
    </div>

    <div class="charts">
      <div id="main-chart"></div>
    </div>

    <div class="content">
      <footer>
        –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å.<br />
        –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –≥—Ä–∞—Ñ–∏–∫ ‚Äî
        <a href="https://seniorsoftwarevlogger.com/feedback/">–Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ</a
        >.<br /><br />
        –° —É–≤–∞–∂–µ–Ω–∏–µ–º,
        <a href="https://t.me/ilinello">–°–µ—Ä–≥–µ–π –ò–ª—å–∏–Ω</a> –∏
        <a href="https://seniorsoftwarevlogger.com/">–î–∏–º–∞ –†–æ–∂–∫–æ–≤</a>.
      </footer>

      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
      ></script>
      <!-- COVID-19 -->
      <ins
        class="adsbygoogle"
        style="display: block;"
        data-ad-client="ca-pub-0669070283353334"
        data-ad-slot="3153456696"
        data-ad-format="horizontal"
        data-full-width-responsive="true"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </body>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-3093719-18"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-3093719-18");
  </script>
</html>
